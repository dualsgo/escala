<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Escala de Trabalho - Dia Seguinte</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap");

      body {
        font-family: "Poppins", sans-serif;
        margin: 0;
        padding: 20px;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        background-color: #f8f9fa;
      }
      .container {
        max-width: 800px;
        width: 100%;
        background: white;
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
      }
      h2 {
        margin-bottom: 20px;
        color: #4361ee;
        text-align: center;
      }
      table {
        width: 100%;
        margin-top: 20px;
        border-collapse: collapse;
      }
      th,
      td {
        border: 1px solid #e9ecef;
        padding: 12px;
        text-align: left;
      }
      th {
        background-color: #4361ee;
        color: white;
      }
      input[type="text"] {
        font-family: "Poppins", sans-serif;
        width: 100%;
        padding: 8px;
        border: 1px solid #ced4da;
        border-radius: 4px;
        box-sizing: border-box;
      }
      select {
        font-family: "Poppins", sans-serif;
        padding: 8px;
        border-radius: 4px;
        border: 1px solid #ced4da;
        width: 100%;
      }
      .btn {
        padding: 10px 20px;
        cursor: pointer;
        border: none;
        border-radius: 5px;
        font-size: 16px;
        font-family: "Poppins", sans-serif;
        transition: all 0.2s;
      }
      .btn-primary {
        background-color: #4361ee;
        color: white;
      }
      .btn-primary:hover {
        background-color: #3a56d4;
      }
      .btn-success {
        background-color: #2a9d8f;
        color: white;
      }
      .btn-success:hover {
        background-color: #24877b;
      }
      .btn-secondary {
        background-color: #6c757d;
        color: white;
      }
      .btn-secondary:hover {
        background-color: #5a6268;
      }
      #resultado {
        margin-top: 20px;
        white-space: pre-wrap;
        background-color: #f1f3f5;
        padding: 15px;
        border-radius: 6px;
        border: 1px solid #dee2e6;
        transition: all 0.3s;
      }
      #copy-message {
        color: #2a9d8f;
        margin-top: 10px;
        display: none;
        font-weight: 600;
      }
      @media (max-width: 600px) {
        .container {
          padding: 15px;
        }
        th,
        td {
          padding: 8px;
        }
        .btn {
          width: 100%;
          margin-bottom: 10px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h2>Escala do Dia Seguinte</h2>
      <p id="data-atual"></p>
      <table>
        <thead>
          <tr>
            <th>Colaborador</th>
            <th>Fun√ß√£o</th>
            <th>Hor√°rio</th>
          </tr>
        </thead>
        <tbody id="tabela-escala"></tbody>
      </table>
      <button
        class="btn btn-success"
        onclick="gerarEscala()"
        style="margin-top: 20px"
      >
        Gerar Escala
      </button>
      <div id="resultado"></div>
      <button
        class="btn btn-secondary"
        onclick="copiarEscala()"
        style="margin-top: 10px"
      >
        Copiar Escala
      </button>
      <p id="copy-message">
        Escala copiada com sucesso! Cole no grupo e confira antes de enviar.
      </p>
    </div>

    <script>
      const colaboradores = [
        "Lidiane",
        "Aline",
        "Jheferson",
        "Luiza",
        "Luiz",
        "Renata",
        "J√∫lia",
        "C√°tia",
        "Erika",
        "Caren",
        "Raissa",
        "Nathan",
        "Jo√£o",
        "Ronaldo",
      ];

      const funcoes = {
        "üî¥ Caixa": "üî¥ Caixa",
        "üü¢ Pacote": "üü¢ Pacote",
        "üü° Organiza√ß√£o": "üü° Organiza√ß√£o",
        "üîµ Venda": "üîµ Venda",
      };

      const horarios = {
        Abertura: [
          "10h √†s 18h", // Padr√£o dias √∫teis
          "12h √†s 20h", // Padr√£o domingos
          "10h √†s 19h", // Extens√£o 1
          "10h √†s 20h", // Extens√£o 2
          "12h √†s 18h", // Turno reduzido
        ],
        Intermedi√°rio: [
          "12h √†s 18h", // Turno padr√£o
          "12h √†s 20h", // Turno estendido
          "13h √†s 19h", // Turno deslocado
          "14h √†s 20h", // Turno tarde
        ],
        Fechamento: [
          "14h √†s 22h", // Padr√£o
          "13h √†s 22h", // In√≠cio antecipado
          "15h √†s 22h", // In√≠cio tardio
          "13h √†s 21h", // Turno especial
        ],
        Folga: ["Folga"],
        Curso: ["Curso"],
      };

      const valoresPadrao = {
        Lidiane: { funcao: "üî¥ Caixa", horario: "10h √†s 18h" },
        Aline: { funcao: "üü¢ Pacote", horario: "10h √†s 18h" },
        Jheferson: { funcao: "üü° Organiza√ß√£o", horario: "10h √†s 18h" },
        Luiza: { funcao: "üü° Organiza√ß√£o", horario: "10h √†s 18h" },
        Luiz: { funcao: "üîµ Venda", horario: "10h √†s 18h" },
        Renata: { funcao: "üîµ Venda", horario: "10h √†s 18h" },
        J√∫lia: { funcao: "üü° Organiza√ß√£o", horario: "12h √†s 18h" },
        C√°tia: { funcao: "üî¥ Caixa", horario: "14h √†s 22h" },
        Erika: { funcao: "üü¢ Pacote", horario: "14h √†s 22h" },
        Caren: { funcao: "üü° Organiza√ß√£o", horario: "14h √†s 22h" },
        Raissa: { funcao: "üü° Organiza√ß√£o", horario: "14h √†s 22h" },
        Nathan: { funcao: "üîµ Venda", horario: "14h √†s 22h" },
        Jo√£o: { funcao: "üîµ Venda", horario: "14h √†s 22h" },
        Ronaldo: { funcao: "üîµ Venda", horario: "14h √†s 22h" },
      };

      function gerarTabela() {
        const tabela = document.getElementById("tabela-escala");
        const hoje = new Date();
        const diaSeguinte = new Date(hoje);
        diaSeguinte.setDate(hoje.getDate() + 1);

        const diaSemana = diaSeguinte.getDay();
        const isDomingo = diaSemana === 0;

        document.getElementById(
          "data-atual"
        ).innerText = `üìÖ ${diaSeguinte.toLocaleDateString("pt-BR", {
          weekday: "long",
          day: "numeric",
          month: "long",
        })}${isDomingo ? " (Domingo)" : diaSemana === 6 ? " (S√°bado)" : ""}`;

        tabela.innerHTML = "";
        colaboradores.forEach((nome) => {
          const padrao = valoresPadrao[nome] || {
            funcao: "üî¥ Caixa",
            horario: "10h √†s 18h",
          };

          // Apenas J√∫lia pode ter a op√ß√£o "Curso"
          const horariosDisponiveis =
            nome === "J√∫lia"
              ? horarios
              : Object.fromEntries(
                  Object.entries(horarios).filter(([key]) => key !== "Curso")
                );

          const linha = `
                    <tr>
                        <td><input type="text" value="${nome}" class="editable"></td>
                        <td>
                            <select>
                                ${Object.values(funcoes)
                                  .map(
                                    (f) =>
                                      `<option value="${f}" ${
                                        f === padrao.funcao ? "selected" : ""
                                      }>${f}</option>`
                                  )
                                  .join("")}
                            </select>
                        </td>
                        <td>
                            <select>
                                ${Object.entries(horariosDisponiveis)
                                  .flatMap(([turno, horariosTurno]) =>
                                    horariosTurno.map(
                                      (h) =>
                                        `<option value="${turno} - ${h}" ${
                                          h === padrao.horario ? "selected" : ""
                                        }>
                                            ${turno} - ${h}
                                        </option>`
                                    )
                                  )
                                  .join("")}
                            </select>
                        </td>
                    </tr>
                `;
          tabela.innerHTML += linha;
        });
      }

      function gerarEscala() {
        const hoje = new Date();
        const diaSeguinte = new Date(hoje);
        diaSeguinte.setDate(hoje.getDate() + 1);
        const diaSemana = diaSeguinte.getDay();
        const isDomingo = diaSemana === 0;

        const dataFormatada = diaSeguinte.toLocaleDateString("pt-BR", {
          weekday: "long",
          day: "numeric",
          month: "long",
        });

        let escalaTexto = `üìÖ Escala - ${dataFormatada}\n\n`;
        const ordemFuncoes = [
          "üî¥ Caixa",
          "üü¢ Pacote",
          "üü° Organiza√ß√£o",
          "üîµ Venda",
        ];
        const linhas = Array.from(
          document.querySelectorAll("#tabela-escala tr")
        );

        // Abertura
        const horarioAbertura = isDomingo ? "12h √†s 20h" : "10h √†s 18h";
        const abertura = linhas
          .filter((tr) => {
            const horario = tr.querySelector("td:nth-child(3) select").value;
            return (
              horario.includes("Abertura") && !horario.includes("Folga")
            );
          })
          .sort((a, b) => {
            const funcaoA = a.querySelector("td:nth-child(2) select").value;
            const funcaoB = b.querySelector("td:nth-child(2) select").value;
            return (
              ordemFuncoes.indexOf(funcaoA) - ordemFuncoes.indexOf(funcaoB)
            );
          })
          .map((tr) => {
            const nome = tr.querySelector("td:nth-child(1) input").value;
            const funcao = tr.querySelector("td:nth-child(2) select").value;
            const horarioParts = tr
              .querySelector("td:nth-child(3) select")
              .value.split(" - ");
            const horarioFinal =
              horarioParts.length > 1 ? horarioParts[1] : horarioParts[0];
            return `${funcao} - ${nome} - ${horarioFinal}`;
          })
          .join("\n");

        if (abertura) {
          escalaTexto += `‚è∞ Abertura (${horarioAbertura})\n`;
          escalaTexto += abertura + "\n";
        }

        // Intermedi√°rio
        const intermediario = linhas
          .filter((tr) => {
            const horario = tr.querySelector("td:nth-child(3) select").value;
            return horario.includes("Intermedi√°rio") && !horario.includes("Folga");
          })
          .sort((a, b) => {
            const funcaoA = a.querySelector("td:nth-child(2) select").value;
            const funcaoB = b.querySelector("td:nth-child(2) select").value;
            return (
              ordemFuncoes.indexOf(funcaoA) - ordemFuncoes.indexOf(funcaoB)
            );
          })
          .map((tr) => {
            const nome = tr.querySelector("td:nth-child(1) input").value;
            const funcao = tr.querySelector("td:nth-child(2) select").value;
            return `${funcao} - ${nome} - 12h √†s 18h`;
          })
          .join("\n");

        if (intermediario) {
          escalaTexto += "\nIntermedi√°rio\n";
          escalaTexto += intermediario + "\n";
        }

        // Fechamento
        const fechamento = linhas
          .filter((tr) => {
            const horario = tr.querySelector("td:nth-child(3) select").value;
            return horario.includes("Fechamento") && !horario.includes("Folga");
          })
          .sort((a, b) => {
            const funcaoA = a.querySelector("td:nth-child(2) select").value;
            const funcaoB = b.querySelector("td:nth-child(2) select").value;
            return (
              ordemFuncoes.indexOf(funcaoA) - ordemFuncoes.indexOf(funcaoB)
            );
          })
          .map((tr) => {
            const nome = tr.querySelector("td:nth-child(1) input").value; // Captura o valor do input
            const funcao = tr.querySelector("td:nth-child(2) select").value;
            return `${funcao} - ${nome} - 14h √†s 22h`;
          })
          .join("\n");

        if (fechamento) {
          escalaTexto += "\nFechamento\n";
          escalaTexto += fechamento + "\n";
        }

        // Folgas
        const folgas = linhas
          .filter((tr) => {
            const horario = tr.querySelector("td:nth-child(3) select").value;
            return horario.includes("Folga");
          })
          .map((tr) => tr.querySelector("td:nth-child(1) input").value); // Captura o valor do input
        if (folgas.length > 0) {
          escalaTexto += `\nFolgas:\n${folgas.join(", ")}`;
        }

        document.getElementById("resultado").innerText = escalaTexto;
      }

      function copiarEscala() {
        const escalaTexto = document.getElementById("resultado").innerText;

        // Try the modern clipboard API with fallback
        if (navigator.clipboard && window.isSecureContext) {
          navigator.clipboard
            .writeText(escalaTexto)
            .then(() => {
              showSuccessMessage();
            })
            .catch((err) => {
              console.error("Erro ao copiar:", err);
              fallbackCopyTextToClipboard(escalaTexto);
            });
        } else {
          fallbackCopyTextToClipboard(escalaTexto);
        }
      }

      function fallbackCopyTextToClipboard(text) {
        const textArea = document.createElement("textarea");
        textArea.value = text;
        textArea.style.position = "fixed";
        textArea.style.opacity = "0";
        document.body.appendChild(textArea);
        textArea.select();

        try {
          const successful = document.execCommand("copy");
          if (successful) {
            showSuccessMessage();
          } else {
            alert(
              "N√£o foi poss√≠vel copiar o texto. Por favor, copie manualmente."
            );
          }
        } catch (err) {
          console.error("Erro ao copiar:", err);
          alert(
            "N√£o foi poss√≠vel copiar o texto. Por favor, copie manualmente."
          );
        }

        document.body.removeChild(textArea);
      }

      function showSuccessMessage() {
        document.getElementById("resultado").style.backgroundColor = "green";
        document.getElementById("copy-message").style.display = "block";
        setTimeout(() => {
          document.getElementById("resultado").style.backgroundColor =
            "#f5f5f5";
          document.getElementById("copy-message").style.display = "none";
        }, 3000);
      }

      gerarTabela();
    </script>
  </body>
</html>